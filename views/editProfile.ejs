<%- include("templates/header") %>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <% if (error) { %>
        <div class="alert alert-danger" role="alert">
          <%= error %>
        </div>
        <% } %>
      <form action="/updateProfile" method="POST">
        <small class="form-text text-muted">* Required fields are mandatory</small>
        <div class="form-group">
          <label for="name">Name: *</label>
          <input type="text" class="form-control" id="name" name="name" value="<%= name %>" required>
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" class="form-control" id="email" name="email" value="<%= email %>" disabled>
        </div>
        <div class="form-group">
          <label for="currentPassword">Current Password: *</label>
          <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
        </div>
        <div class="form-group">
          <label for="newPassword">New Password:</label>
          <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="Optional" onchange="checkNewPassword()">
        </div>
        <div class="form-group">
          <label for="confirmPassword">Confirm Password:</label>
          <input type="password" class="form-control" id="confirmPassword" name="confirmPassword">
        </div>
        <div class="form-group mb-3">
          <label for="dietaryRestrictions">Dietary Restrictions: (Optional)</label>
          <% allRestrictions.forEach(function(dietaryRestriction) { %>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="dietaryRestrictions" 
            value="<%= dietaryRestriction.name %>" 
            <% if (dietaryRestrictions.includes(dietaryRestriction.name)) { %>checked <% } %>
            id="dietaryRestriction<%= dietaryRestriction.id %>">
            <label class="form-check-label" for="dietaryRestriction<%= dietaryRestriction.id %>">
              <%= dietaryRestriction.name %>
            </label>
          </div>
          <% }); %>
        </div>
        <button type="submit" class="btn btn-primary">Update Profile</button>
      </form>
    </div>
  </div>
</div>

<script>
  function checkNewPassword() {
    var newPasswordInput = document.getElementById("newPassword");
    var confirmPasswordInput = document.getElementById("confirmPassword");
    if (newPasswordInput.value !== "") {
      confirmPasswordInput.required = true;
    } else {
      confirmPasswordInput.required = false;
    }
  }
</script>

<%- include("templates/footer") %>
